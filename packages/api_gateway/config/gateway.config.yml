http:
    port: "${PORT:-8080}"
admin:
    port: 9876
    host: localhost

apiEndpoints:
    health:
        host: "*"
        paths: ["/", "/health"]
    auth:
        host: "*"
        paths: ["/api/auth*", "/api/user*"]
    company:
        host: "*"
        paths: ["/api/company*"]
    stripe:
        host: "*"
        paths: ["/api/stripe*"]
    dashboard:
        host: "*"
        paths: ["/api/dashboard*"]
    invoice:
        host: "*"
        paths: ["/api/invoice*"]
    quote:
        host: "*"
        paths: ["/api/quote*"]
    product:
        host: "*"
        paths: ["/api/product*"]
    customer:
        host: "*"
        paths: ["/api/customer*"]
    ai:
        host: "*"
        paths: ["/api/ai*"]
serviceEndpoints:
    auth_service:
        url: "${AUTH_SERVICE_URL:-http://localhost:3001}"
    company_service:
        url: "${COMPANY_SERVICE_URL:-http://localhost:3002}"
    stripe_service:
        url: "${STRIPE_SERVICE_URL:-http://localhost:3003}"
    dashboard_service:
        url: "${DASHBOARD_SERVICE_URL:-http://localhost:3004}"
    invoice_service:
        url: "${INVOICE_SERVICE_URL:-http://localhost:3005}"
    quote_service:
        url: "${QUOTE_SERVICE_URL:-http://localhost:3006}"
    product_service:
        url: "${PRODUCT_SERVICE_URL:-http://localhost:3008}"
    customer_service:
        url: "${CUSTOMER_SERVICE_URL:-http://localhost:3009}"
    ai_service:
        url: "${AI_SERVICE_URL:-http://localhost:3011}"
policies:
    - basic-auth
    - cors
    - expression
    - key-auth
    - log
    - oauth2
    - proxy
    - rate-limit
    - better-auth-jwt
pipelines:
    health:
        apiEndpoints:
            - health
        policies:
            - expression:
                  - action:
                        jscode: |
                            req.egContext.res.status(200).json({
                              status: "OK",
                              message: "ZenBilling API Gateway is running",
                              timestamp: new Date().toISOString()
                            });
    auth:
        apiEndpoints:
            - auth
        policies:
            - cors:
                  - action:
                        origin: "${CLIENT_URL:-http://localhost:3000}"
                        credentials: true
                        methods: "GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS"
                        allowedHeaders: "Content-Type,Authorization"
            - proxy:
                  - action:
                        serviceEndpoint: auth_service
                        changeOrigin: true
                        stripPath: false
    company:
        apiEndpoints:
            - company
        policies:
            - cors:
                  - action:
                        origin: "${CLIENT_URL:-http://localhost:3000}"
                        credentials: true
                        methods: "GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS"
                        allowedHeaders: "Content-Type,Authorization"
            - better-auth-jwt:
            - proxy:
                  - action:
                        serviceEndpoint: company_service
                        changeOrigin: true
                        stripPath: false
    stripe:
        apiEndpoints:
            - stripe
        policies:
            - proxy:
                  - action:
                        serviceEndpoint: stripe_service
                        changeOrigin: true
                        stripPath: false
    dashboard:
        apiEndpoints:
            - dashboard
        policies:
            - cors:
                  - action:
                        origin: "${CLIENT_URL:-http://localhost:3000}"
                        credentials: true
                        methods: "GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS"
                        allowedHeaders: "Content-Type,Authorization"
            - better-auth-jwt:
            - proxy:
                  - action:
                        serviceEndpoint: dashboard_service
                        changeOrigin: true
                        stripPath: false
    invoice:
        apiEndpoints:
            - invoice
        policies:
            - cors:
                  - action:
                        origin: "${CLIENT_URL:-http://localhost:3000}"
                        credentials: true
                        methods: "GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS"
                        allowedHeaders: "Content-Type,Authorization"
            - better-auth-jwt:
            - proxy:
                  - action:
                        serviceEndpoint: invoice_service
                        changeOrigin: true
                        stripPath: false
    quote:
        apiEndpoints:
            - quote
        policies:
            - cors:
                  - action:
                        origin: "${CLIENT_URL:-http://localhost:3000}"
                        credentials: true
                        methods: "GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS"
                        allowedHeaders: "Content-Type,Authorization"
            - better-auth-jwt:
            - proxy:
                  - action:
                        serviceEndpoint: quote_service
                        changeOrigin: true
                        stripPath: false
    product:
        apiEndpoints:
            - product
        policies:
            - cors:
                  - action:
                        origin: "${CLIENT_URL:-http://localhost:3000}"
                        credentials: true
                        methods: "GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS"
                        allowedHeaders: "Content-Type,Authorization"
            - better-auth-jwt:
            - proxy:
                  - action:
                        serviceEndpoint: product_service
                        changeOrigin: true
                        stripPath: false
    customer:
        apiEndpoints:
            - customer
        policies:
            - cors:
                  - action:
                        origin: "${CLIENT_URL:-http://localhost:3000}"
                        credentials: true
                        methods: "GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS"
                        allowedHeaders: "Content-Type,Authorization"
            - better-auth-jwt:
            - proxy:
                  - action:
                        serviceEndpoint: customer_service
                        changeOrigin: true
                        stripPath: false
    ai:
        apiEndpoints:
            - ai
        policies:
            - proxy:
                  - action:
                        serviceEndpoint: ai_service
                        changeOrigin: true
                        stripPath: false
